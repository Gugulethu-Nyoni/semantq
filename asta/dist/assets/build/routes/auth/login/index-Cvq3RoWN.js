import"../../../../modulepreload-polyfill-B5Qt9EMX.js";import{A as f,R as p}from"../../../../config-Cv_0j0S0.js";import"../../../../routes-BLb1p8ki.js";console.log("✅ Login script initialized");const a={DASHBOARD:`${f.DASHBOARD}`,LOGIN_API:`${f.BASE_URL}/login`,VALIDATE_SESSION:`${f.BASE_URL}/validate-session`},i=document.getElementById("login-form"),m=document.getElementById("auth-status"),y=i.querySelector('button[type="submit"]');function c(e,t=!1){console.log(`UI Status: ${e}`),m.textContent=e,m.className=t?"error":"success",m.classList.remove("hidden")}function u(e){y.disabled=e,i.classList.toggle("loading",e)}async function S(){console.log("🔒 Starting session verification...");try{const e=performance.now(),t=await fetch(a.VALIDATE_SESSION,{method:"GET",credentials:"include"}),r=(performance.now()-e).toFixed(2);if(console.log(`Session verification: ${t.status} (${r}ms)`),!t.ok)return console.log("❌ Validation failed - response not OK"),!1;const n=await t.json();return console.log("Validation response:",n),n.success&&n.data?.valid===!0}catch(e){return console.error("❌ Session verification error:",e),!1}}async function w(){console.log("➡️ Verifying dashboard accessibility...");try{if(!(await fetch(a.DASHBOARD,{method:"HEAD",credentials:"include"})).ok)throw new Error(`Dashboard ${a.DASHBOARD} unavailable`);console.log("✅ Dashboard verified - redirecting..."),window.location.replace(a.DASHBOARD)}catch(e){console.error("❌ Dashboard redirect failed:",e),c(`Dashboard ${a.DASHBOARD} unavailable. Please contact support.`,!0),u(!1)}}i.addEventListener("submit",async e=>{e.preventDefault(),console.log("📝 Form submission started"),u(!0);const t=i.email.value.trim(),r=i.password.value;if(!t||!r){console.log("❌ Validation failed - missing fields"),c("Please enter both email and password.",!0),u(!1);return}c("Authenticating..."),console.log("🔐 Attempting authentication...");try{const n=performance.now(),s=await fetch(a.LOGIN_API,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:t,password:r})}),l=(performance.now()-n).toFixed(2);if(console.log(`Login response: ${s.status} (${l}ms)`),!s.ok){const o=await s.json();throw console.error("❌ Login failed:",o),new Error(o.message||"Authentication failed")}const d=await s.json();if(console.log("✅ Auth successful:",d),console.log("🔍 Verifying session..."),!await S())throw new Error("Session validation failed");c("Login successful! Redirecting..."),console.log("➡️ Preparing dashboard redirect"),setTimeout(w,1500)}catch(n){console.error("❌ Authentication error:",{message:n.message,stack:n.stack}),c(n.message||"Authentication failed. Please try again.",!0),u(!1)}});i.email.focus();console.log("📄 Login form ready");async function A(){console.log("Layout script started");function e(){const t={head:'<head><link rel="stylesheet" href="/auth/css/auth.css" /></head>'};t&&function(n){const s=document.head,l=document.createElement("template");l.innerHTML=n;const d=[];for(s.querySelectorAll("script, link[rel='modulepreload']").forEach(o=>{(o.tagName==="SCRIPT"&&o.type==="module"||o.tagName==="LINK"&&o.rel==="modulepreload"||o.src?.includes("/assets/router-")||o.href?.includes("/assets/modulepreload-polyfill"))&&d.push(o.outerHTML)});s.firstChild;)s.removeChild(s.firstChild);const h=l.content.cloneNode(!0);s.appendChild(h),d.forEach(o=>{const g=document.createElement("template");g.innerHTML=o,s.appendChild(g.content.firstChild)}),console.log("Updated head with layout content while preserving Vite scripts.")}(t.head)}e()}async function D(){console.log(p)}async function E(){try{await new Promise(e=>{document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e()}),console.log("DOM is ready"),await A(),await D()}catch(e){console.error("Error in main function:",e)}}E();
